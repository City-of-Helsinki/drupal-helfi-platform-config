!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.helfiLink=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/typing.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"ckeditor5/src/widget.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";i.d(n,{default:()=>p});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/widget.js"),s=i("ckeditor5/src/typing.js");const o={linkProtocol:{label:Drupal.t("Protocol"),machineName:"protocol",selectListOptions:{https:"https://",tel:"tel:",mailto:"mailto:"},type:"select",group:"helper"},linkNewWindowConfirm:{label:Drupal.t("The link meets the accessibility requirements"),description:Drupal.t('I have made sure that the description of this link clearly states that it will open in a new tab. <a href="@wcag-techniques" target="_blank">See WCAG 3.2.5 accessibility requirement (the link opens in a new tab).</a>',{"@wcag-techniques":"https://www.w3.org/WAI/WCAG21/Techniques/general/G200.html"}),machineName:"link-new-window-confirm",viewAttribute:{target:"_blank"},type:"checkbox",group:"advanced",isVisible:!1},linkNewWindow:{label:Drupal.t("Open in new window/tab"),machineName:"link-new-window",viewAttribute:"data-link-new-window",type:"checkbox",group:"advanced",isVisible:!0},linkTitle:{label:Drupal.t("Title"),description:Drupal.t("Populates the title attribute of the link, usually shown as a small tooltip on hover."),machineName:"link-title",viewAttribute:"title",type:"input",group:"advanced"},linkId:{label:Drupal.t("ID"),description:Drupal.t("Allows linking to this content using a URL fragment (#). Must be unique."),machineName:"link-id",viewAttribute:"id",type:"input",group:"advanced"},linkClass:{machineName:"link-class",viewAttribute:{class:"link"},type:"static"}};class l extends e.Plugin{static get requires(){return[t.Widget]}static get pluginName(){return"HelfiLinkEditing"}init(){Object.keys(o).forEach((e=>{o[e].machineName&&(this._convertAttribute(e,o[e].viewAttribute),this._removeAttributeOnUnlinkCommandExecute(e),this._refreshAttributeValue(e))})),this._addAttributeOnLinkCommandExecute(Object.keys(o))}_convertAttribute(e,t){const{editor:i}=this;if(i.model.schema.extend("$text",{allowAttributes:e}),i.conversion.for("downcast").attributeToElement({model:e,view:(e,{writer:i})=>{const n={};e&&"object"==typeof t?n[Object.keys(t)]=t[Object.keys(t)]:n[t]=e;const s=i.createAttributeElement("a",n,{priority:5});return i.setCustomProperty("link",!0,s),s}}),"object"==typeof t){const i=Object.keys(t)[0],n=t[Object.keys(t)];this.editor.conversion.for("upcast").attributeToAttribute({view:{name:"a",key:i,value:n},model:{key:e,value:e=>!(!e.hasAttribute(i)||e.getAttribute(i)!==n)}})}else i.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{[t]:!0}},model:{key:e,value:e=>e.getAttribute(t)}})}_addAttributeOnLinkCommandExecute(e){const{editor:t}=this,i=t.commands.get("link");let n=!1;i.on("execute",((i,s)=>{if(s.length<3)return;if(n)return void(n=!1);i.stop(),n=!0;const o=s[s.length-1],{model:l}=t,{selection:r}=l.document;l.change((i=>{t.execute("link",...s);const n=r.getFirstPosition();e.forEach((e=>{if(r.isCollapsed){const t=n.textNode||n.nodeBefore;o[e]?i.setAttribute(e,o[e],i.createRangeOn(t)):i.removeAttribute(e,i.createRangeOn(t)),i.removeSelectionAttribute(e)}else{const t=l.schema.getValidRanges(r.getRanges(),e);for(const n of t)o[e]?i.setAttribute(e,o[e],n):i.removeAttribute(e,n)}}))}))}),{priority:"high"})}_removeAttributeOnUnlinkCommandExecute(e){const{editor:t}=this,{model:i}=this.editor,{selection:n}=i.document,o=t.commands.get("unlink");let l=!1;o.on("execute",(o=>{l||(o.stop(),i.change((()=>{l=!0,t.execute("unlink"),l=!1,i.change((t=>{let o;o=n.isCollapsed?[(0,s.findAttributeRange)(n.getFirstPosition(),e,n.getAttribute(e),i)]:i.schema.getValidRanges(n.getRanges(),e);for(const i of o)t.removeAttribute(e,i)}))})))}),{priority:"high"})}_refreshAttributeValue(e){const{editor:t}=this,{model:i}=this.editor,{selection:n}=i.document,s=t.commands.get("link");s.set(e,null),i.document.on("change",(()=>{s[e]=n.getAttribute(e)}))}}var r=i("ckeditor5/src/ui.js"),a=i("ckeditor5/src/utils.js");class c extends r.View{constructor(e){super(e);const t=this.bindTemplate;this.set("class"),this.set("isVisible",!0),this.set("isChecked",!1),this.set("label"),this.set("description"),this.set("id",null),this.set("tabindex",-1),this.children=this.createCollection(),this.labelView=this._createLabelView(),this.checkboxInputView=this._createCheckboxInputView(),this.checkboxSpanToggle=this._createCheckboxSpanToggleView(),this.bind("isVisible").to(this,"_updateVisibility"),this.setTemplate({tag:"div",attributes:{class:["form-type--checkbox","helfi-link-checkbox",t.if("isVisible","is-hidden",(e=>!e)),t.to("class")]},on:{keydown:t.to((e=>{e.target===this.element&&e.keyCode===(0,a.getCode)("space")&&(this.isChecked=!this.isChecked)}))},children:this.children})}render(){super.render(),this.children.add(this.checkboxInputView),this.children.add(this.checkboxSpanToggle),this.children.add(this.labelView)}focus(){this.element.focus()}_createCheckboxInputView(){const e=new r.View,t=this.bindTemplate;return e.setTemplate({tag:"input",attributes:{type:"checkbox",id:t.to("id"),checked:t.if("isChecked")},on:{change:t.to((e=>{this.isChecked=e.target.checked}))}}),e}_createCheckboxSpanToggleView(){const e=new r.View;return e.setTemplate({tag:"span",attributes:{class:["checkbox-toggle"]},children:[{tag:"span",attributes:{class:["checkbox-toggle__inner"]}}]}),e}_createLabelView(){const e=new r.View;return e.setTemplate({tag:"label",attributes:{for:this.bindTemplate.to("id")},children:[{text:this.bindTemplate.to("label")}]}),e}_updateVisibility(e){e?this.element.classList.remove("is-hidden"):this.element.classList.add("is-hidden")}}class d extends r.LabeledFieldView{constructor(e,t){super(e,t),this.set("isVisible",!0),this.bind("isVisible").to(this,"updateVisibility")}updateVisibility(e){e?this.element.classList.remove("is-hidden"):this.element.classList.add("is-hidden")}}class h extends r.View{constructor(e,t){super(e),this.advancedChildren=t;const i=this.bindTemplate;this.set("isOpen",!1),this.set("label"),this.set("id",null),this.children=this.createCollection(),this.detailsSummary=this._createDetailsSummary(),this.setTemplate({tag:"details",attributes:{id:i.to("id"),class:["ck-helfi-link-details",i.if("isOpen","ck-is-open",(e=>e))],open:i.if("isOpen")},on:{keydown:i.to((e=>{e.target===this.element&&e.keyCode===(0,a.getCode)("space")&&(this.isOpen=!this.isOpen)}))},children:this.children})}render(){super.render(),this.children.add(this.detailsSummary),this.children.addMany(this.advancedChildren)}focus(){this.element.focus()}_createDetailsSummary(){const e=new r.View;return e.setTemplate({tag:"summary",attributes:{role:"button",class:["ck-helfi-link-details__summary"],tabindex:0},children:[{text:this.bindTemplate.to("label")}]}),e}}class u extends e.Plugin{constructor(e){super(e),this.editor=e,this.advancedChildren=new a.Collection,this.formElements=o}init(){this._addContextualBalloonClass();const e=Object.keys(this.formElements).reverse();e.forEach((e=>{if(!this.formElements[e].machineName)return;const t=this._createFormField(e);this._handleDataLoadingIntoFormField(e),this.formElements[e].group&&"advanced"===this.formElements[e].group&&this.advancedChildren.add(t)})),this._createAndHandleAdvancedSettings(),this._manipulateUrlInputField(),this._handleCheckboxes(),this._handleFormFieldSubmit(e)}_addContextualBalloonClass(){const{editor:e}=this,t=e.plugins.get("LinkUI").formView,i=e.plugins.get(r.ContextualBalloon);i._rotatorView.content.on("add",((e,n)=>{if(n!==t||!i.hasView(t)||i.view.element.classList.contains("helfi-contextual-balloon"))return;i.remove(n),i.add({view:t,position:i._getBalloonPosition(),balloonClassName:"helfi-contextual-balloon",withArrow:!1});const s=i.view.element.closest(".ck-body-wrapper > .ck-body");s.classList.contains("ck-reset_all")&&s.classList.remove("ck-reset_all")})),i._rotatorView.content.on("remove",((e,n)=>{if(n!==t||!i.hasView(t))return;const s=i.view.element.closest(".ck-body-wrapper > .ck-body");s.classList.contains("ck-reset_all")||s.classList.add("ck-reset_all")})),t.extendTemplate({attributes:{class:["helfi-link-form"]}})}_manipulateUrlInputField(){const{editor:e}=this,t=e.plugins.get("LinkUI").formView,i=document.createElement("span");i.textContent=Drupal.t("Start typing to find content."),i.classList.add("helfi-link-form__field_description"),t.urlInputView.element.appendChild(i)}_createSelectList(e,t){const{editor:i}=this,n=i.plugins.get("LinkUI").formView,s=new d(this.editor.locale,r.createLabeledDropdown),{urlInputView:o}=n;n.urlInputView.on("change:isEmpty",((e,t,i)=>{s.updateVisibility(i)}));const l=new a.Collection;return Object.keys(t).forEach((e=>{l.add({type:"button",attributes:{class:["helfi-link-form"]},model:new r.Model({commandValue:t[e],label:t[e],withText:!0,attributes:{class:["ck","ck-link-protocol"],tabindex:"-1"}}),withText:!0})})),(0,r.addListToDropdown)(s.fieldView,l),s.fieldView.on("execute",(e=>{o.isEmpty&&e.source.commandValue&&(o.fieldView.value=e.source.commandValue)})),s.set("isVisible",!0),s}_createAndHandleAdvancedSettings(){const{editor:e}=this,t=e.plugins.get("LinkUI").formView,i=new h(e.locale,this.advancedChildren);return i.set({label:Drupal.t("Advanced settings"),id:"advanced-settings",isOpen:!1}),t.children.add(i,2),e.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((e,i)=>{i===t&&t.advancedSettings&&(t.advancedSettings.element.open=!1,t.advancedSettings.detailsSummary.element.ariaExpanded=!1,t.advancedSettings.detailsSummary.element.ariaPressed=!1)})),t.advancedSettings=i}_createCheckbox(e){const t=new c(this.editor.locale),i=this.formElements[e];return t.set({isVisible:i.isVisible,tooltip:!0,class:"ck-find-checkboxes__box",id:i.machineName,label:i.label}),t}_createFormField(e){const{editor:t}=this,i=t.plugins.get("LinkUI").formView,n=this.formElements[e];let s={};switch(n.type){case"select":s=this._createSelectList(e,n.selectListOptions);break;case"checkbox":s=this._createCheckbox(e,n);break;case"static":s=!1;break;default:s=new r.LabeledFieldView(t.locale,r.createLabeledInputText)}if(s)return s.machineName=e,s.class=`helfi-link--${n.machineName}`,s.label=n.label,n.description&&(s.infoText=n.description),n.group&&"advanced"===n.group||i.children.add(s,"select"===n.type?0:1),i.on("render",(()=>{i._focusables.add(s,1),i.focusTracker.add(s.element)})),i[e]=s}_handleFormFieldSubmit(e){const{editor:t}=this,i=t.plugins.get("LinkUI").formView,n=t.commands.get("link");this.listenTo(i,"submit",(()=>{const t=e.reduce(((e,t)=>(e[t]="checkbox"===this.formElements[t].type?i?.[t]?.checkboxInputView?.element?.checked:i?.[t]?.fieldView?.element?.value??"",e)),{});t.linkNewWindowConfirm&&t.linkNewWindow||(t.linkNewWindowConfirm=!1,t.linkNewWindow=!1,i.linkNewWindowConfirm.checkboxInputView.element.checked&&i.linkNewWindowConfirm.checkboxInputView.element.click(),i.linkNewWindow.checkboxInputView.element.checked&&i.linkNewWindow.checkboxInputView.element.click()),n.once("execute",((e,i)=>{if(i.length<3)i.push(t);else{if(3!==i.length)throw Error("The link command has more than 3 arguments.");Object.assign(i[2],t)}}),{priority:"highest"})}),{priority:"high"})}_handleDataLoadingIntoFormField(e){const{editor:t}=this,i=t.commands.get("link"),n=t.plugins.get("LinkUI").formView,s=this.formElements[e];"linkProtocol"!==e&&"static"!==s.type&&("checkbox"===s.type?n[e].checkboxInputView.bind("isChecked").to(i,e):n[e].fieldView.bind("value").to(i,e),t.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((t,o)=>{o===n&&("checkbox"===s.type?("linkNewWindowConfirm"===e&&n[e]._updateVisibility(!!n.linkNewWindow.checkboxInputView.isChecked),n[e].checkboxInputView.element.checked=i[e]||""):n[e].fieldView.element.value=i[e]||"")})))}_handleCheckboxes(){if(!this.formElements.linkNewWindowConfirm||!this.formElements.linkNewWindow)return;const{editor:e}=this,t=e.plugins.get("LinkUI").formView;if(!t.linkNewWindowConfirm.element.description){const e=document.createElement("div");e.innerHTML=this.formElements.linkNewWindowConfirm.description,e.classList.add("helfi-link-form__field_description"),t.linkNewWindowConfirm.element.appendChild(e)}t.linkNewWindow.on("change:isChecked",((e,i,n)=>{n||t.linkNewWindowConfirm.checkboxInputView.element.click(),t.linkNewWindowConfirm._updateVisibility(n)})),t.linkNewWindowConfirm.on("change:isChecked",((e,i,n)=>{n||t.linkNewWindow.checkboxInputView.element.click()}))}}class m extends e.Plugin{static get requires(){return[l,u]}}const p={HelfiLink:m}})(),n=n.default})()));