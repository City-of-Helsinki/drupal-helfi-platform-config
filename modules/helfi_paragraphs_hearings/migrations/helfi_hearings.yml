langcode: en
status: true
dependencies:
  enforced:
    module:
      - helfi_paragraphs_hearings
id: helfi_hearings
migration_tags:
  - helfi_hearings
migration_group: helfi_hearings
label: 'Helfi hearings'
source:
  constants:
    HEARING_BASE_URL: 'https://kerrokantasi.hel.fi/'
    HEARING_FILE_DIR: 'public://hearing_images/'
  ids:
    id:
      type: string
  plugin: url
  urls: 'https://api.hel.fi/kerrokantasi/v1/hearing/?format=json&langcode=fi&open=true'
  track_changes: true
  data_fetcher_plugin: http
  data_parser_plugin: json
  item_selector: results
  fields:
    -
      name: id
      label: Id
      selector: id
    -
      name: title
      label: 'Title'
      selector: title/fi
    -
      name: title_en
      label: 'Title en'
      selector: title/en
    -
      name: title_sv
      label: 'Title sv'
      selector: title/sv
    -
      name: comments
      label: 'Comments'
      selector: n_comments
    -
      name: published_at
      label: 'Open at'
      selector: open_at
    -
      name: unpublish_on
      label: 'Close at'
      selector: close_at
    -
      name: slug
      label: 'Slug'
      selector: slug
    -
      name: image
      label: 'Image'
      selector: main_image
process:
  field_external_id: id
  title: title
  langcode:
    plugin: default_value
    default_value: fi
  uid:
    plugin: default_value
    default_value: 1
  field_comments: comments
  field_url:
    plugin: concat
    source:
      - constants/HEARING_BASE_URL
      - slug
  published_at:
      plugin: format_date
      source: published_at
      from_format: 'Y-m-d\TH:i:s\Z'
      to_format: 'U'
      from_timezone: 'Europe/Helsinki'
      to_timezone: 'UTC'
  unpublish_on:
    plugin: format_date
    source: unpublish_on
    from_format: 'Y-m-d\TH:i:s\Z'
    to_format: 'U'
    from_timezone: 'Europe/Helsinki'
    to_timezone: 'UTC'
  _filename:
    plugin: filename
    source: image/url
  _destination_path:
    plugin: concat
    source:
      - constants/HEARING_FILE_DIR
      - '@_filename'
  _file_copy:
    plugin: file_copy
    source:
      - image/url
      - '@_destination_path'
    file_exists: replace
    move: false
  field_hearing_main_image:
    plugin: media_handler
  type:
    plugin: default_value
    default_value: hearing
destination:
  plugin: entity:node
