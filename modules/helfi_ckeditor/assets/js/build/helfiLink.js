!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.helfiLink=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/typing.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"ckeditor5/src/widget.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,i),l.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";i.d(n,{default:()=>f});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/widget.js"),s=i("ckeditor5/src/typing.js");const l={linkIcon:{label:Drupal.t("Icon",{},{context:"CKEditor5 Helfi Link plugin"}),machineName:"icon",selectListOptions:{},type:"select",group:"advanced",isVisible:!1,viewAttribute:"data-icon-start"},linkVariant:{label:Drupal.t("Design"),machineName:"variant",selectListOptions:{link:Drupal.t("Normal link",{},{context:"CKEditor5 Helfi Link plugin"}),primary:Drupal.t("Button primary"),secondary:Drupal.t("Button secondary"),supplementary:Drupal.t("Button supplementary")},type:"select",group:"advanced",isVisible:!0,viewAttribute:"data-variant"},linkProtocol:{label:Drupal.t("Protocol",{},{context:"CKEditor5 Helfi Link plugin"}),machineName:"protocol",selectListOptions:{https:"https://",tel:"tel:",mailto:"mailto:"},type:"select",group:"helper",viewAttribute:"data-protocol",isVisible:!0},linkNewWindowConfirm:{label:Drupal.t("The link meets the accessibility requirements",{},{context:"CKEditor5 Helfi Link plugin"}),description:Drupal.t('I have made sure that the description of this link clearly states that it will open in a new tab. <a href="@wcag-techniques" target="_blank">See WCAG 3.2.5 accessibility requirement (the link opens in a new tab).</a>',{"@wcag-techniques":"https://www.w3.org/WAI/WCAG21/Techniques/general/G200.html"},{context:"CKEditor5 Helfi Link plugin"}),machineName:"link-new-window-confirm",viewAttribute:{target:"_blank"},type:"checkbox",group:"advanced",isVisible:!1},linkNewWindow:{label:Drupal.t("Open in new window/tab",{},{context:"CKEditor5 Helfi Link plugin"}),machineName:"link-new-window",type:"checkbox",group:"advanced",isVisible:!0}};class o extends e.Plugin{static get requires(){return[t.Widget]}static get pluginName(){return"HelfiLinkEditing"}init(){Object.keys(l).forEach((e=>{l[e].machineName&&(this._convertAttribute(e,l[e].viewAttribute),this._removeAttributeOnUnlinkCommandExecute(e),this._refreshAttributeValue(e))})),this._defineHelfiButtonConverters(),this._addAttributeOnLinkCommandExecute(Object.keys(l))}_defineHelfiButtonConverters(){const{editor:e}=this;e.model.schema.extend("tableCell",{allowContentOf:"$block"}),e.conversion.for("upcast").elementToElement({view:{name:"a"},model:e=>{const t=Array.from(e.getChildren()).find((e=>"span"===e.name&&e.hasClass("hds-button__label")));if(!t){const t=Array.from(e.getChildren()).find((e=>!(!e.name||"span"!==e.name)&&(!e.getAttribute("dir")&&!e.getAttribute("lang")&&e)));return void(t&&(e._removeChildren(t.index,1),Array.from(t.getChildren()).forEach((t=>{e._appendChild(t)}))))}const i=Array.from(e.getChildren()).length;i>0&&e._removeChildren(0,i),Array.from(t.getChildren()).forEach((t=>{e._appendChild(t)}))},converterPriority:"highest"});const i={"data-design":"data-variant","data-protocol":"data-protocol","data-selected-icon":"data-icon-start","data-is-external":"data-is-external"};Object.keys(i).forEach((n=>{const{conversion:s,model:l}=this.editor,o=i[n];l.schema.extend("$text",{allowAttributes:n}),l.schema.extend("$text",{allowAttributes:o}),e.conversion.for("upcast").attributeToAttribute({view:{name:"a",key:n},model:{key:o,value:e=>{let t;if(e.getAttribute(n)&&(t=e.getAttribute(n)),e.getAttribute(o)&&(t=e.getAttribute(o)),"data-design"===n&&(t=(e=>{const t=e.split(" "),i=t.find((e=>e.startsWith("hds-button--"))),n=t.find((e=>e.endsWith("hds-button")));return i?i.replace("hds-button--",""):n?"primary":null})(t)),"data-is-external"!==n)return t}}}),e.conversion.for("upcast").attributeToAttribute({view:{name:"a",key:o},model:{key:o,value:e=>{let t;return e.getAttribute(o)&&(t=e.getAttribute(o)),t}}}),s.for("dataDowncast").attributeToElement({model:n,view:(e,{writer:t})=>{if(e)return t.createAttributeElement("a",{[o]:e},{priority:5})}}),s.for("dataDowncast").attributeToElement({model:o,view:(e,{writer:t})=>{if(e)return t.createAttributeElement("a",{[o]:e},{priority:5})}});const r=(e,i,n)=>{if(!i)return;const s=n.createAttributeElement("a",{[e]:i},{priority:5});return(0,t.toWidgetEditable)(s,n,{label:Drupal.t("Edit link")})};s.for("editingDowncast").attributeToElement({model:n,view:(e,{writer:t})=>r(o,e,t)}),s.for("editingDowncast").attributeToElement({model:o,view:(e,{writer:t})=>r(o,e,t)})}))}_convertAttribute(e,t){const{editor:i}=this;if(t)if(i.model.schema.extend("$text",{allowAttributes:e}),i.conversion.for("downcast").attributeToElement({model:e,view:(e,{writer:i})=>{const n={};e&&"object"==typeof t?n[Object.keys(t)]=t[Object.keys(t)]:n[t]=e;const s=i.createAttributeElement("a",n,{priority:5});return i.setCustomProperty("link",!0,s),s}}),"object"==typeof t){const i=Object.keys(t)[0],n=t[Object.keys(t)];this.editor.conversion.for("upcast").attributeToAttribute({view:{name:"a",key:i,value:n},model:{key:e,value:e=>!(!e.hasAttribute(i)||e.getAttribute(i)!==n)}})}else i.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{[t]:!0}},model:{key:e,value:e=>e.getAttribute(t)}})}_addAttributeOnLinkCommandExecute(e){const{editor:t}=this,i=t.commands.get("link");let n=!1;i.on("execute",((i,s)=>{if(s.length<3)return;if(n)return void(n=!1);i.stop(),n=!0;const l=s[s.length-1],{model:o}=t,{selection:r}=o.document;o.change((i=>{t.execute("link",...s),e.forEach((e=>{if(r.isCollapsed){const t=e=>{const t=e.textNode||e.nodeBefore;if(!t){const t=i.createRange(e);return i.setSelection(t),t}return i.createRangeOn(t)};l[e]?i.setAttribute(e,l[e],t(r.getFirstPosition())):i.removeAttribute(e,t(r.getFirstPosition())),i.removeSelectionAttribute(e)}else{const t=o.schema.getValidRanges(r.getRanges(),e);let n=t.next();for(;!n.done;){const s=n.value;l[e]?i.setAttribute(e,l[e],s):i.removeAttribute(e,s),n=t.next()}}}))}))}),{priority:"high"})}_removeAttributeOnUnlinkCommandExecute(e){const{editor:t}=this,{model:i}=this.editor,{selection:n}=i.document,l=t.commands.get("unlink");let o=!1;l.on("execute",(l=>{o||(l.stop(),i.change((()=>{o=!0,t.execute("unlink"),o=!1,i.change((t=>{let l;l=n.isCollapsed?[(0,s.findAttributeRange)(n.getFirstPosition(),e,n.getAttribute(e),i)]:i.schema.getValidRanges(n.getRanges(),e),Array.isArray(l)&&l.forEach((i=>t.removeAttribute(e,i)))}))})))}),{priority:"high"})}_refreshAttributeValue(e){const{editor:t}=this,{model:i}=this.editor,{selection:n}=i.document,s=t.commands.get("link");s.set(e,null),i.document.on("change",(()=>{s[e]=n.getAttribute(e)}))}}var r=i("ckeditor5/src/ui.js"),a=i("ckeditor5/src/utils.js");class c extends r.View{constructor(e){super(e);const t=this.bindTemplate;this.set("class"),this.set("isVisible",!0),this.set("isChecked",!1),this.set("label"),this.set("description"),this.set("id",null),this.set("tabindex",-1),this.children=this.createCollection(),this.labelView=this._createLabelView(),this.checkboxInputView=this._createCheckboxInputView(),this.checkboxSpanToggle=this._createCheckboxSpanToggleView(),this.bind("isVisible").to(this,"updateVisibility"),this.bind("isChecked").to(this,"updateChecked"),this.setTemplate({tag:"div",attributes:{class:["form-type--checkbox","helfi-link-checkbox",t.if("isVisible","is-hidden",(e=>!e)),t.to("class")]},on:{keydown:t.to((e=>{e.target===this.element&&e.keyCode===(0,a.getCode)("space")&&(this.isChecked=!this.isChecked)}))},children:this.children})}render(){super.render(),this.children.add(this.checkboxInputView),this.children.add(this.checkboxSpanToggle),this.children.add(this.labelView)}focus(){this.element.focus()}_createCheckboxInputView(){const e=new r.View,t=this.bindTemplate;return e.setTemplate({tag:"input",attributes:{type:"checkbox",id:t.to("id"),checked:t.if("isChecked")},on:{change:t.to((e=>{this.isChecked=e.target.checked}))}}),e}_createCheckboxSpanToggleView(){const e=new r.View,t=this.bindTemplate;return e.setTemplate({tag:"span",attributes:{class:["checkbox-toggle"],id:t.to("id")},children:[{tag:"span",attributes:{class:["checkbox-toggle__inner"]}}]}),e}_createLabelView(){const e=new r.View;return e.setTemplate({tag:"label",attributes:{for:this.bindTemplate.to("id")},children:[{text:this.bindTemplate.to("label")}]}),e}updateVisibility(e){e?this.element.classList.remove("is-hidden"):this.element.classList.add("is-hidden")}updateChecked(e){e!==this.isChecked&&this.checkboxInputView?.element.click()}}class d extends r.View{constructor(e,t){super(e.locale),this.options=t,this.tomSelect=!1,this.linkCommandConfig=e.config.get("link"),this.loadedIcons=this.linkCommandConfig?.loadedIcons,this.set("isVisible",!1),this.bind("isVisible").to(this,"updateVisibility");const i=this.bindTemplate;this.set("isOpen",!1),this.set("label"),this.set("id",null),this.setTemplate({tag:"select",attributes:{id:i.to("id"),class:["ck-helfi-link-select-list"],"data-placeholder":this.options.label,autocomplete:"off"},on:{keydown:i.to((e=>{e.target===this.element&&e.keyCode===(0,a.getCode)("space")&&(this.isOpen=!this.isOpen)}))}})}updateVisibility(e){e?(this.tomSelect?.wrapper?.classList.remove("is-hidden"),this.element.classList.remove("is-hidden")):(this.tomSelect?.wrapper?.classList.add("is-hidden"),this.element.classList.add("is-hidden"))}render(){super.render()}focus(){this.element.focus()}selectListDefaultOptions(){return{valueField:"option",labelField:"name",searchField:"title",maxItems:1,placeholder:this.options.label,create:!1}}}class h extends d{renderTomSelect(e,t){if(!this.tomSelect&&e){const e=super.selectListDefaultOptions(),i=(e,t)=>`\n          <span style="align-items: center; display: flex; height: 100%;">\n            <span class="hel-icon--name" style="margin-left: 8px;">${t(e.title)}</span>\n          </span>\n        `,n={...e,options:Object.keys(t).map((e=>({option:e,title:t[e]}))),render:{option:(e,t)=>i(e,t),item:(e,t)=>i(e,t)}};this.tomSelect=new TomSelect(this.element,n)}}}class u extends r.View{constructor(e,t){super(e),this.advancedChildren=t;const i=this.bindTemplate;this.set("isOpen",!1),this.set("label"),this.set("id",null),this.children=this.createCollection(),this.detailsSummary=this._createDetailsSummary(),this.setTemplate({tag:"details",attributes:{id:i.to("id"),class:["ck-helfi-link-details",i.if("isOpen","ck-is-open",(e=>e))],open:i.if("isOpen")},on:{keydown:i.to((e=>{e.target===this.element&&e.keyCode===(0,a.getCode)("space")&&(this.isOpen=!this.isOpen)}))},children:this.children})}render(){super.render(),this.children.add(this.detailsSummary),this.children.addMany(this.advancedChildren)}focus(){this.element.focus()}_createDetailsSummary(){const e=new r.View;return e.setTemplate({tag:"summary",attributes:{role:"button",class:["ck-helfi-link-details__summary"],tabindex:0},children:[{text:this.bindTemplate.to("label")}]}),e}}class m extends d{renderTomSelect(e,t){if(!this.tomSelect&&e){const e=super.selectListDefaultOptions(),i=(e,t)=>`\n          <span style="align-items: center; display: flex; height: 100%;">\n            <span class="hel-icon--name" style="margin-left: 8px;">${t(e.title)}</span>\n          </span>\n        `,n={...e,plugins:{dropdown_input:{},remove_button:{title:"Remove this item"}},options:Object.keys(t).map((e=>({option:e,title:t[e]}))),render:{option:(e,t)=>i(e,t),item:(e,t)=>i(e,t)}};this.tomSelect=new TomSelect(this.element,n)}}}class p extends d{renderTomSelect(e){if(!this.tomSelect&&e){const e=super.selectListDefaultOptions(),t=(e,t)=>`\n          <span style="align-items: center; display: flex; height: 100%;">\n            <span class="hel-icon hel-icon--${e.icon}" aria-hidden="true"></span>\n            <span class="hel-icon--name" style="margin-left: 8px;">${t(e.name)}</span>\n          </span>\n        `,i={...e,plugins:{dropdown_input:{},remove_button:{title:"Remove this item"}},valueField:"icon",searchField:["name"],options:Object.keys(this.loadedIcons).map((e=>({icon:e,name:this.loadedIcons[e]}))),render:{option:(e,i)=>t(e,i),item:(e,i)=>t(e,i)}};this.tomSelect=new TomSelect(this.element,i)}}}class b extends e.Plugin{constructor(e){super(e),this.editor=e,this.advancedChildren=new a.Collection,this.formElements=l}init(){this._addContextualBalloonClass();const e=Object.keys(this.formElements).reverse();e.forEach((e=>{if(!this.formElements[e].machineName)return;const t=this._createFormField(e);this._handleDataLoadingIntoFormField(e),this.formElements[e].group&&"advanced"===this.formElements[e].group&&this.advancedChildren.add(t)})),this._createAndHandleAdvancedSettings(),this._manipulateUrlInputField(),this._handleCheckboxes(),this._handleFormFieldSubmit(e)}_addContextualBalloonClass(){const{editor:e}=this,t=e.plugins.get("LinkUI").formView,i=e.plugins.get(r.ContextualBalloon);i._rotatorView.content.on("add",((e,n)=>{n===t&&i.hasView(t)&&!i.view.element.classList.contains("helfi-contextual-balloon")&&(i.remove(n),i.add({view:t,position:i._getBalloonPosition(),balloonClassName:"helfi-contextual-balloon",withArrow:!1}))})),t.extendTemplate({attributes:{class:["helfi-link-form","ck-reset_all-excluded"]}})}_manipulateUrlInputField(){const{editor:e}=this,t=e.plugins.get("LinkUI").formView,i=document.createElement("span");i.textContent=Drupal.t("Start typing to find content.",{},{context:"CKEditor5 Helfi Link plugin"}),i.classList.add("helfi-link-form__field_description"),t.urlInputView.element.appendChild(i)}_createSelectList(e,t){const{editor:i}=this,n=i.plugins.get("LinkUI").formView;let s={};switch(e){case"linkProtocol":s=new h(i,t),n.urlInputView.on("change:isEmpty",((e,t,i)=>{s.updateVisibility(i)}));break;case"linkVariant":s=new m(i,t);break;case"linkIcon":s=new p(i,t),n.linkVariant.on("change:isEmpty",((e,t,i)=>{s.updateVisibility(i)}))}return s.set({isVisible:t.isVisible,id:t.machineName,label:t.label}),s}_createAndHandleAdvancedSettings(){const{editor:e}=this,t=e.plugins.get("LinkUI").formView,i=new u(e.locale,this.advancedChildren);return i.set({label:Drupal.t("Advanced settings",{},{context:"CKEditor5 Helfi Link plugin"}),id:"advanced-settings",isOpen:!1}),t.children.add(i,2),e.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((e,i)=>{i===t&&(t.advancedSettings&&(t.advancedSettings.element.open=!1,t.advancedSettings.detailsSummary.element.ariaExpanded=!1,t.advancedSettings.detailsSummary.element.ariaPressed=!1),t.urlInputView.errorText&&(t.urlInputView.errorText=""))})),t.advancedSettings=i,t.advancedSettings}_createCheckbox(e){const t=new c(this.editor.locale),i=this.formElements[e];return t.set({isVisible:i.isVisible,tooltip:!0,class:"ck-find-checkboxes__box",id:i.machineName,label:i.label}),t}_createFormField(e){const{editor:t}=this,i=t.plugins.get("LinkUI").formView,n=this.formElements[e];let s={};switch(n.type){case"select":s=this._createSelectList(e,n);break;case"checkbox":s=this._createCheckbox(e);break;case"static":s=!1;break;default:s=new r.LabeledFieldView(t.locale,r.createLabeledInputText)}if(s)return s.machineName=e,s.class=`helfi-link--${n.machineName}`,s.label=n.label,n.description&&(s.infoText=n.description),n.group&&"advanced"===n.group||i.children.add(s,"select"===n.type?0:1),i.on("render",(()=>{i._focusables.add(s,1),i.focusTracker.add(s.element)})),i[e]=s,i[e]}_handleFormFieldSubmit(e){const{editor:t}=this,{selection:i}=t.model.document,n=t.plugins.get("LinkUI").formView,s=t.commands.get("link");this.listenTo(n,"submit",(t=>{n.urlInputView?.fieldView?.element?.value||(n.urlInputView.errorText=Drupal.t("The link URL field cannot be empty.",{},{context:"CKEditor5 Helfi Link plugin"}),t.stop());const l=e.reduce(((e,t)=>{switch(t){case"linkVariant":{const i=n?.[t]?.tomSelect.getValue();i&&"link"!==i&&(e[t]=i);break}case"linkIcon":e[t]=n?.[t]?.tomSelect.getValue();break;default:e[t]=n?.[t]?.fieldView?.element?.value??""}return"checkbox"===this.formElements[t].type&&(e[t]=n?.[t]?.checkboxInputView?.element?.checked),e}),{});i.isCollapsed&&!n.urlInputView?.fieldView?.element?.value&&l.linkId&&(n.urlInputView.errorText=Drupal.t("When there is no selection, the link URL must be provided. To add a link without a URL, first select text in the editor and then proceed with adding the link.",{},{context:"CKEditor5 Helfi Link plugin"}),t.stop()),l.linkNewWindowConfirm&&l.linkNewWindow||(l.linkNewWindowConfirm=!1,l.linkNewWindow=!1,n.linkNewWindowConfirm.checkboxInputView.element.checked&&n.linkNewWindowConfirm.checkboxInputView.element.click(),n.linkNewWindow.checkboxInputView.element.checked&&n.linkNewWindow.checkboxInputView.element.click()),s.once("execute",((e,t)=>{if(t.length<3)t.push(l);else{if(3!==t.length)throw Error("The link command has more than 3 arguments.");Object.assign(t[2],l)}}),{priority:"highest"})}),{priority:"high"})}_handleDataLoadingIntoFormField(e){const{editor:t}=this,i=t.commands.get("link"),n=t.plugins.get("LinkUI").formView,s=this.formElements[e];switch(s.type){case"static":return;case"checkbox":n[e].checkboxInputView.bind("isChecked").to(i,e);break;case"input":n[e].fieldView.bind("value").to(i,e)}t.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((t,l)=>{if(l===n)switch(s.type){case"select":n[e].renderTomSelect(n[e].element,s?.selectListOptions),n[e].tomSelect.clear(),i[e]&&n[e].tomSelect.addItem(i[e],!0),"linkProtocol"===e&&n[e].tomSelect.on("item_add",(t=>{n.urlInputView.isEmpty&&(n.urlInputView.fieldView.value=s.selectListOptions[t],n.urlInputView.focus(),n[e].tomSelect.clear())})),"linkVariant"===e&&n[e].tomSelect.on("item_add",(e=>{n?.linkIcon.updateVisibility("link"!==e),"link"===e&&n?.linkIcon.tomSelect.clear()})),"linkIcon"===e&&n[e].tomSelect.on("init",(()=>{n[e].updateVisibility(!1)}));break;case"checkbox":{const t=!!i.linkNewWindowConfirm;n[e].updateChecked(t),n.linkNewWindowConfirm.updateVisibility(t);break}default:n[e].fieldView.element.value=i[e]||""}}))}_handleCheckboxes(){if(!this.formElements.linkNewWindowConfirm||!this.formElements.linkNewWindow)return;const{editor:e}=this,t=e.plugins.get("LinkUI").formView;if(!t.linkNewWindowConfirm.element.description){const e=document.createElement("div");e.innerHTML=this.formElements.linkNewWindowConfirm.description,e.classList.add("helfi-link-form__field_description"),t.linkNewWindowConfirm.element.appendChild(e)}t.linkNewWindow.on("change:isChecked",((e,i,n)=>{t.linkNewWindowConfirm.updateChecked(!1),t.linkNewWindowConfirm.updateVisibility(n)}))}}class k extends e.Plugin{static get requires(){return[o,b]}}const f={HelfiLink:k}})(),n=n.default})()));