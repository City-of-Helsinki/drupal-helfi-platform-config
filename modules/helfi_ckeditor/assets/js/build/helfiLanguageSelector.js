!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.helfiLanguageSelector=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"ckeditor5/src/widget.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";i.d(n,{default:()=>h});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/widget.js"),o=i("ckeditor5/src/utils.js");function r(e,t){return`${e}:${t=t||(0,o.getLanguageDirection)(e)}`}function l(e){const[t,i]=e.split(":");return{languageCode:t,textDirection:i}}class s extends e.Command{execute({languageCode:e,textDirection:t}){const{model:i}=this.editor,n=i.document.selection,o=!!e&&r(e,t);i.change((e=>{const t=n.getFirstPosition(),r=t.textNode||t.nodeBefore;if(n.isCollapsed)o?e.setSelectionAttribute("helfiLanguageSelector",o):r?e.removeAttribute("helfiLanguageSelector",e.createRangeOn(r)):e.removeSelectionAttribute("helfiLanguageSelector");else{const t=i.schema.getValidRanges(n.getRanges(),"helfiLanguageSelector");for(const i of t)o?e.setAttribute("helfiLanguageSelector",o,i):e.removeAttribute("helfiLanguageSelector",i)}}))}refresh(){const{model:e}=this.editor,{selection:t}=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(t,"helfiLanguageSelector")}_getValueFromFirstAllowedNode(){const e=this.editor.model,t=e.schema,i=e.document.selection;if(i.isCollapsed)return i.getAttribute("helfiLanguageSelector")||!1;for(const e of i.getRanges())for(const i of e.getItems())if(t.checkAttribute(i,"helfiLanguageSelector"))return i.getAttribute("helfiLanguageSelector")||!1;return!1}}class a extends e.Plugin{static get requires(){return[t.Widget]}static get pluginName(){return"HelfiLanguageSelectorEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"helfiLanguageSelector"}),e.model.schema.setAttributeProperties("helfiLanguageSelector",{copyOnEnter:!0});const t=this.editor.conversion;t.for("upcast").elementToAttribute({model:{key:"helfiLanguageSelector",value:e=>r(e.getAttribute("lang"),e.getAttribute("dir"))},view:{name:"span",attributes:{lang:/[\s\S]+/}}}),t.for("downcast").attributeToElement({model:"helfiLanguageSelector",view:(e,{writer:t},i)=>{if(!e)return;if(!i.item.is("$textProxy")&&!i.item.is("documentSelection"))return;const{languageCode:n,textDirection:o}=l(e);return t.createAttributeElement("span",{lang:n,dir:o})}}),e.commands.add("helfiLanguageSelectorCommand",new s(e))}}var c=i("ckeditor5/src/ui.js");class d extends c.View{constructor(e,t){super(e,t);const i=this.bindTemplate;this.editor=t,this.set("isOpen",!1),this.set("label"),this.set("id",null),this.setTemplate({tag:"select",attributes:{id:i.to("id"),class:["ck-helfi-select-list",i.if("isOpen","ck-is-open",(e=>e))],open:i.if("isOpen"),placeholder:Drupal.t("Select language")},on:{keydown:i.to((e=>{e.target===this.element&&e.keyCode===(0,o.getCode)("space")&&(this.isOpen=!this.isOpen)}))}})}focus(){this.element.focus()}}class u extends e.Plugin{constructor(e){super(e),this.editor=e,this.advancedChildren=new o.Collection,this.helfiLanguageSelectorConfig=this.editor.config.get("helfiLanguageSelector"),this.languageList=this.helfiLanguageSelectorConfig?.language_list,this.updateSelection=!1}init(){const e=this.editor,t=Drupal.t("Remove language"),i=Drupal.t("Select language");e.ui.componentFactory.add("helfiLanguageSelector",(n=>{const o=(0,c.createDropdown)(n);let r,l;o.buttonView.set({label:i,icon:'<?xml version="1.0" encoding="utf-8"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" xml:space="preserve">\n<path d="M-17.3,0.9"/>\n\t<rect x="1.3" y="1.3" width="7.9" height="1.3"/>\n\t<rect x="1.3" y="6.8" width="7.9" height="1.3"/>\n\t<rect x="1.3" y="9.5" width="7.9" height="1.3"/>\n\t<rect y="4" width="10.6" height="1.3"/>\n\t<path d="M15.9,3.6c1.6-0.2,2.9-0.5,4.1-1l-0.5-1.2c-1.2,0.5-2.6,0.8-4.2,1c-2,0.2-3.7,0-3.7,0l-0.2,1.3c0,0,0.9,0.1,2.1,0.1 c0.3,0,0.7,0,1,0v3.1h-3.6v1.3h3.6v4h-3.7v6.5h1.3v-1.3h6.5V18H20v-5.9h-4.1v-4H20V6.8h-4.1V3.6z M18.6,16.1h-6.5v-2.6h6.5V16.1z" />\n\t<path d="M1.3,18.7h1.3v-1.3h5.3V18h1.3v-5.9h-8V18.7z M7.9,13.5v2.6H2.6v-2.6H7.9z"/>\n</svg>\n',tooltip:!0}),o.extendTemplate({attributes:{class:["helfi-language-selector"]}}),o.panelView.extendTemplate({attributes:{class:["helfi-language-selector__dropdown-panel","ck-reset_all-excluded"]}});const s=this.editor.commands.get("helfiLanguageSelectorCommand");return o.on("change:isOpen",(()=>{if(l&&l.options&&(s.value&&!l.items.includes(this._getCommandValue(s.value))?l.setValue([this._getCommandValue(s.value)],!0):!s.value&&l.items.length>0&&l.clear()),r)return;r=new d(n,this.editor),o.panelView.children.add(r),o.panelPosition="sw",r.delegate("execute").to(o);const i=(e,t)=>`\n            <span style="align-items: center; display: flex; height: 100%;">\n              <span class="hel-icon--name" style="margin-left: 8px;">${t(e.title)}</span>\n            </span>\n          `,a={plugins:{remove_button:{title:t}},valueField:"languageCode",labelField:"title",searchField:["title"],items:[this._getCommandValue(s.value)],options:[this.languageList],create:!1,render:{option:(e,t)=>i(e,t),item:(e,t)=>i(e,t)},onItemAdd:t=>{s.value!==t&&(s.execute({languageCode:t,textDirection:this.languageList.find((e=>e.languageCode===t)).textDirection}),e.editing.view.focus())},onItemRemove:()=>{s.value&&(s.execute({languageCode:!1}),e.editing.view.focus())}};l=new TomSelect(r.element,a)})),o}))}_getCommandValue(e){if(!e)return;const{languageCode:t}=l(e);return t||void 0}}class g extends e.Plugin{static get requires(){return[a,u]}}const h={HelfiLanguageSelector:g}})(),n=n.default})()));