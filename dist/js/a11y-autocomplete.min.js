/*! @drupal/autocomplete - v0.0.2 - 2022-01-17 */
var A11yAutocomplete=function(){"use strict";function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function e(e){for(var i=1;i<arguments.length;i++){var s=null!=arguments[i]?arguments[i]:{};i%2?t(Object(s),!0).forEach((function(t){n(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):t(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var o=function(){function t(e){var s=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,t),this.keyCode=Object.freeze({TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40}),this.originalInput=e.cloneNode(),this.input=e,this.count=document.querySelectorAll("[data-autocomplete-input]").length,this.listboxId="autocomplete-l".concat(this.count),this.supportedOptions=["source","cardinality","minChars","separatorChar","firstCharacterIgnoreList","createLiveRegion","autoFocus","allowRepeatValues","groupBy","templates","classes","minCharAssistiveHint","inputAssistiveHint","noResultsAssistiveHint","someResultsAssistiveHint","oneResultAssistiveHint","highlightedAssistiveHint"],this.defaultOptions={autoFocus:!1,firstCharacterIgnoreList:",",minChars:1,sort:!1,disabled:!1,source:[],groupBy:null,cardinality:1,separatorChar:",",createLiveRegion:!0,listZindex:100,allowRepeatValues:null,searchDelay:300,templates:{suggestion:function(t){return(t.label||t.value||t).trim()},inputValue:function(t){return t.value||t.label||t}},classes:{wrapper:"",input:"",inputLoading:"",listbox:"",group:"",groupLabel:"",option:""},minCharAssistiveHint:"Type @count or more characters for results",inputAssistiveHint:"When autocomplete results are available use up and down arrows to review and enter to select. Touch device users, explore by touch or with swipe gestures.",noResultsAssistiveHint:"No results found",someResultsAssistiveHint:"There are @count results available.",oneResultAssistiveHint:"There is one result available.",highlightedAssistiveHint:"@selectedItem @position of @count is highlighted"},this.options=this.initOptions(this.filterOptions(n),this.filterOptions(this.attributesToOptions())),"string"==typeof this.options.source&&(this.options.source=JSON.parse(this.options.source)),"function"!=typeof this.options.source&&!Array.isArray(this.options.source))throw new TypeError("options.source is not an array or a function.");this.selected=null,this.preventCloseOnBlur=!1,this.isOpened=!1,this.suggestions=[],this.announceTimeOutId=null,this.searchTimeOutId=null,this.wrapper=document.createElement("div"),this.implementWrapper(),this.implementInput(),this.assistiveHintId="".concat(this.input.id,"-assistive-hint"),this.inputHintRead=!1,this.implementDescription(),this.listboxWrapper=document.createElement(this.options.groupBy?"div":"ul"),this.implementList(),this.appendList(),this.liveRegion=null,this.implementLiveRegion(),this.events={input:{input:function(t){return s.inputListener(t)},blur:function(t){return s.blurHandler(t)},keydown:function(t){return s.inputKeyDown(t)}},listboxWrapper:{mousedown:function(t){return t.preventDefault()},click:function(t){return s.itemClick(t)},keydown:function(t){return s.listKeyDown(t)},blur:function(t){return s.blurHandler(t)},focus:function(t){return s.listFocus(t)}}},Object.keys(this.events).forEach((function(t){Object.keys(s.events[t]).forEach((function(e){s[t].addEventListener(e,s.events[t][e])}))})),this.api={destroy:this.destroy.bind(this),id:this.input.id,_internal_object:this},this.triggerEvent("autocomplete-created")}var n,o,r;return n=t,o=[{key:"filterOptions",value:function(t){var e=this,i={},s={};return Object.keys(t).forEach((function(n){e.supportedOptions.includes(n)?i[n]=t[n]:s[n]=t[n]})),Object.keys(s).length&&console.warn("Rejected autocomplete options: ",s),i}},{key:"mergeNestedOptions",value:function(t){for(var i={},s=arguments.length,n=new Array(s>1?s-1:0),o=1;o<s;o++)n[o-1]=arguments[o];return n.forEach((function(s){s&&s[t]&&(i=e(e({},i),s[t]))})),i}},{key:"initOptions",value:function(){for(var t=this.defaultOptions,i={},s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];var r=this.mergeNestedOptions.apply(this,["templates",t].concat(n)),a=this.mergeNestedOptions.apply(this,["classes",t].concat(n));return n.forEach((function(t){i=e(e({},i),t)})),e(e(e({},t),i),{templates:r,classes:a})}},{key:"implementWrapper",value:function(){this.applyClasses("wrapper"),this.wrapper.setAttribute("data-autocomplete-wrapper",""),this.input.parentNode.insertBefore(this.wrapper,this.input),this.wrapper.appendChild(this.input)}},{key:"implementInput",value:function(){this.applyClasses("input"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("data-autocomplete-input",""),this.input.setAttribute("aria-owns",this.listboxId),this.input.setAttribute("role","combobox"),this.input.setAttribute("aria-expanded","false"),this.input.hasAttribute("id")||this.input.setAttribute("id","autocomplete-input-".concat(this.count))}},{key:"implementDescription",value:function(){var t=document.createElement("span");t.textContent=this.minCharsMessage()+this.options.inputAssistiveHint,t.classList.add("visually-hidden"),t.setAttribute("id",this.assistiveHintId),this.wrapper.appendChild(t);var e=this.input.getAttribute("aria-describedby")||"",i="".concat(e," ").concat(this.assistiveHintId).replace(/\s+/g," ").trim();this.input.setAttribute("aria-describedby",i)}},{key:"appendList",value:function(){this.input.parentNode.appendChild(this.listboxWrapper)}},{key:"implementList",value:function(){this.applyClasses("listbox"),this.listboxWrapper.setAttribute("role","listbox"),this.listboxWrapper.setAttribute("data-autocomplete-item-list",""),this.listboxWrapper.setAttribute("id",this.listboxId),this.listboxWrapper.setAttribute("hidden","")}},{key:"implementLiveRegion",value:function(){!0===this.options.createLiveRegion&&(this.liveRegion=document.createElement("span"),this.liveRegion.setAttribute("data-autocomplete-live-region",""),this.liveRegion.setAttribute("aria-live","assertive"),this.input.parentNode.appendChild(this.liveRegion)),"string"==typeof this.options.liveRegion&&(this.liveRegion=document.querySelector(this.options.liveRegion))}},{key:"attributesToOptions",value:function(){var t={classes:{}},i=this.input.dataset.autocomplete?JSON.parse(this.input.dataset.autocomplete):{},s=this.input.dataset;for(var n in s)if(n.includes("autocomplete")&&"autocomplete"!==n&&"autocompleteInput"!==n){var o=n.replace("autocomplete","");o=o.charAt(0).toLowerCase()+o.slice(1);var r=s[n];["true","false"].includes(r)?t[o]="true"===r:["cardinality","minChars"].includes(o)?t[o]=+r:/^classes\w+$/.test(o)?(o=(o=o.replace("classes","")).charAt(0).toLowerCase()+o.slice(1),t.classes[o]=r):t[o]=r}return e(e({},t),i)}},{key:"blurHandler",value:function(t){window.clearTimeout(this.announceTimeOutId),this.preventCloseOnBlur?(this.preventCloseOnBlur=!1,t.preventDefault()):(this.triggerEvent("autocomplete-change"),this.close())}},{key:"removeAssistiveHint",value:function(){if(!this.inputHintRead){var t=document.querySelector('[id="'.concat(this.assistiveHintId,'"]'));t&&t.parentNode&&t.parentNode.removeChild(t);var e=(this.input.getAttribute("aria-describedby")||"").replace(this.assistiveHintId,"").replace(/\s+/g," ").trim();""===e?this.input.removeAttribute("aria-describedby"):this.input.setAttribute("aria-describedby",e),this.inputHintRead=!0}}},{key:"listKeyDown",value:function(t){if(this.listboxWrapper.contains(document.activeElement)&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&t.keyCode!==this.keyCode.TAB){switch(this.listboxWrapper.querySelectorAll('[aria-selected="true"]').forEach((function(t){t.setAttribute("aria-selected","false")})),t.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:this.selectItem(document.activeElement,t),this.close(),this.input.focus();break;case this.keyCode.ESC:case this.keyCode.TAB:this.input.focus(),this.close();break;case this.keyCode.UP:this.focusPrev();break;case this.keyCode.DOWN:this.focusNext()}t.stopPropagation(),t.preventDefault()}}},{key:"listFocus",value:function(t){}},{key:"focusPrev",value:function(){this.preventCloseOnBlur=!0;var t=document.activeElement.getAttribute("data-autocomplete-item"),e=parseInt(t,10)-1,i=this.listboxWrapper.querySelector('[data-autocomplete-item="'.concat(e,'"]'));i?this.highlightItem(i):this.input.focus()}},{key:"focusNext",value:function(){var t=document.activeElement.getAttribute("data-autocomplete-item"),e=parseInt(t,10)+1,i=this.listboxWrapper.querySelector('[data-autocomplete-item="'.concat(e,'"]'));i&&(this.preventCloseOnBlur=!0,this.highlightItem(i))}},{key:"highlightItem",value:function(t){t.setAttribute("aria-selected","true"),t.focus();var e=t.closest("[data-autocomplete-item]").getAttribute("data-autocomplete-item"),i=this.suggestions[e];this.triggerEvent("autocomplete-highlight",{selected:i.item}),this.announceHighlight(t)}},{key:"announceHighlight",value:function(t){var e=this;window.clearTimeout(this.announceTimeOutId),this.announceTimeOutId=setTimeout((function(){return e.sendToLiveRegion(e.highlightMessage(t))}),500)}},{key:"highlightMessage",value:function(t){var e=t.closest("[data-autocomplete-item]").getAttribute("data-autocomplete-item"),i=this.suggestions[e].value;return this.options.highlightedAssistiveHint.replace("@selectedItem",i).replace("@position",t.getAttribute("aria-posinset")).replace("@count",this.suggestions.length)}},{key:"inputKeyDown",value:function(t){var e=t.keyCode;this.isOpened&&(e===this.keyCode.ESC&&this.close(),e===this.keyCode.DOWN&&(t.preventDefault(),this.preventCloseOnBlur=!0,this.highlightItem(this.listboxWrapper.querySelector('[role="option"]')))),this.removeAssistiveHint()}},{key:"itemClick",value:function(t){var e=t.target;e&&0===t.button&&this.selectItem(e,t)}},{key:"selectItem",value:function(t,e){var i=t.closest("[data-autocomplete-item]").getAttribute("data-autocomplete-item"),s=this.suggestions[i].item;this.triggerEvent("autocomplete-select",{selected:s},!0,e)&&(this.replaceInputValue(t),e.preventDefault(),this.close(),this.triggerEvent("autocomplete-selection-added",{added:t.textContent}))}},{key:"replaceInputValue",value:function(t){var e=t.closest("[data-autocomplete-item]").getAttribute("data-autocomplete-item"),i=this.suggestions[e],s=i.value,n=i.item;this.selected=n;var o=this.separator();if(o.length>0){var r=this.previousItems(o);this.input.value="".concat(r).concat(s)}else this.input.value=s}},{key:"separator",value:function(){var t=this.options.cardinality;return this.splitValues().length-1<t||t<=0?this.options.separatorChar:""}},{key:"previousItems",value:function(t){var e=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp("^.+".concat(e,"\\s*|")),s=this.inputValue().match(i)[0];return s&&s.length>0?"".concat(s.trim()," "):""}},{key:"applyClasses",value:function(t){var e=this.options.classes,i=this[t];"listbox"===t&&(i=this.listboxWrapper),e[t]&&i&&i instanceof Element&&this.addClasses(i,e[t])}},{key:"addClasses",value:function(t,e){e&&e.split(" ").forEach((function(e){return t.classList.add(e)}))}},{key:"removeClasses",value:function(t,e){e&&e.split(" ").forEach((function(e){return t.classList.remove(e)}))}},{key:"doSearch",value:function(t){var e=this,i=this.options,s=i.disabled,n=i.minChars,o=i.firstCharacterIgnoreList,r=i.cardinality;if(s)this.close();else{var a=this.extractLastInputValue();if(a&&a.length<n)this.displayResults([]);else if(a&&o.includes(a[0]))this.displayResults([]);else{var u=this.splitValues();if(r>0&&u.length>r)this.displayResults([]);else if(this.triggerEvent("autocomplete-pre-search",{},!0,t))if(a&&a.length>0)if("function"==typeof this.options.source)this.addClasses(this.input,this.options.classes.inputLoading),this.options.source(a,(function(t){e.removeClasses(e.input,e.options.classes.inputLoading),e.triggerEvent("autocomplete-response",{list:t});var i=e.normalizeSuggestionItems(t),s=e.applySelectionConstraints(i,e.splitValues());e.displayResults(s)}));else{if(!Array.isArray(this.options.source))throw new TypeError("options.source is not an array or a function.");var l=this.options.source.filter((function(t){return e.filterResults(t,a)}));this.triggerEvent("autocomplete-response",{list:l});var p=this.normalizeSuggestionItems(l),c=this.applySelectionConstraints(p,this.splitValues());this.displayResults(c)}else this.displayResults([])}}}},{key:"inputListener",value:function(t){var e=this;this.searchTimeOutId&&0!==this.options.searchDelay||(this.searchTimeOutId=setTimeout((function(){e.doSearch(t),e.searchTimeOutId=null}),this.options.searchDelay))}},{key:"normalizeSuggestionItems",value:function(t){var e=this.options.templates,i=e.suggestion,s=e.inputValue;return t.map((function(t,e){return{label:i(t),value:s(t),index:e,item:t}}))}},{key:"displayResults",value:function(t){var e=this;if(this.suggestions=t,this.listboxWrapper.innerHTML="",this.suggestions.length){!1!==this.options.sort&&(this.suggestions=this.sortSuggestions(this.suggestions));var i=document.createDocumentFragment(),s=i.appendChild.bind(i),n=this.suggestionItem.bind(this),o=this.options.groupBy;o?Object.values(this.suggestions.reduce(this.groupByCallback(o),{})).map((function(t){var i=t.label,s=t.index,o=t.suggestions,r="".concat(e.listboxId,"-g").concat(s),a=e.suggestionGroup(i,r),u=a.appendChild.bind(a);return o.map(n).forEach(u),a})).forEach(s):this.suggestions.map(n).forEach(s),this.listboxWrapper.appendChild(i)}0===this.suggestions.length?this.close():this.open(),window.clearTimeout(this.announceTimeOutId),this.announceTimeOutId=setTimeout((function(){return e.sendToLiveRegion(e.resultsMessage(e.suggestions.length))}),1400)}},{key:"sortSuggestions",value:function(t){return t.sort((function(t,e){return t.label.toUpperCase()>e.label.toUpperCase()?1:-1}))}},{key:"groupByCallback",value:function(t){var e=0,i=0;return function(s,n){var o=n.item[t];return o?(n.index=e++,s[o]||(s[o]={label:o,index:i++,suggestions:[]}),s[o].suggestions.push(n),s):s}}},{key:"suggestionGroup",value:function(t,e){var i=document.createElement("ul");i.setAttribute("role","group"),i.setAttribute("aria-labelledby",e);var s=document.createElement("li");return s.innerHTML=t,s.setAttribute("role","presentation"),s.setAttribute("id",e),i.appendChild(s),this.addClasses(i,this.options.classes.group),this.addClasses(s,this.options.classes.groupLabel),i}},{key:"suggestionItem",value:function(t){var e=this,i=t.label,s=t.index,n=document.createElement("li");return n.innerHTML=i,n.setAttribute("role","option"),n.setAttribute("tabindex","-1"),n.setAttribute("id","".concat(this.listboxId,"-s").concat(s)),n.setAttribute("data-autocomplete-item",s),n.setAttribute("aria-posinset",s+1),n.setAttribute("aria-selected","false"),n.onblur=function(t){return e.blurHandler(t)},this.addClasses(n,this.options.classes.option),n}},{key:"open",value:function(){this.input.setAttribute("aria-expanded","true"),this.listboxWrapper.removeAttribute("hidden"),this.listboxWrapper.style.zIndex=this.options.listZindex,this.isOpened=!0,this.listboxWrapper.style.minWidth="".concat(this.input.offsetWidth-4,"px"),this.triggerEvent("autocomplete-open"),this.options.autoFocus&&(this.preventCloseOnBlur=!0,this.highlightItem(this.listboxWrapper.querySelector('[data-autocomplete-item="0"]')))}},{key:"close",value:function(){this.isOpened&&(this.input.setAttribute("aria-expanded","false"),this.listboxWrapper.setAttribute("hidden",""),this.isOpened=!1,this.triggerEvent("autocomplete-close"))}},{key:"extractLastInputValue",value:function(){return this.splitValues().pop()}},{key:"inputValue",value:function(){return this.input.value}},{key:"splitValues",value:function(){for(var t=this.inputValue(),e=[],i=!1,s="",n=t.length,o=0;o<n;o++){var r=t.charAt(o);'"'===r?(s+=r,i=!i):r!==this.options.separatorChar||i?s+=r:(e.push(s.trim()),s="")}return t.length>0&&e.push(s.trim()),e}},{key:"filterResults",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=t.label||t.value||t;return RegExp(e.trim().replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),"i").test(i)}},{key:"applySelectionConstraints",value:function(t,e){var i=this.options,s=i.cardinality,n=i.allowRepeatValues;if(s>0&&e.length>s)return[];if(n)return t;var o=t.filter((function(t){var i=t.value;return!e.includes(i)}));return o.forEach((function(t,e){return t.index=e})),o}},{key:"sendToLiveRegion",value:function(t){this.liveRegion&&(this.liveRegion.textContent=t)}},{key:"resultsMessage",value:function(t){return(0===t?this.options.noResultsAssistiveHint:1===t?this.options.oneResultAssistiveHint:this.options.someResultsAssistiveHint).replace("@count",t)}},{key:"minCharsMessage",value:function(){return this.options.minChars>1?"".concat(this.options.minCharAssistiveHint.replace("@count",this.options.minChars),". "):""}},{key:"destroy",value:function(){var t=this;Object.keys(this.events).forEach((function(e){Object.keys(t.events[e]).forEach((function(i){t[e].removeEventListener(i,t.events[e][i])}))})),this.listboxWrapper&&this.listboxWrapper.parentNode&&this.listboxWrapper.parentNode.removeChild(this.listboxWrapper),this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.originalInput,this.wrapper),this.triggerEvent("autocomplete-destroy")}},{key:"triggerEvent",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=new CustomEvent(t,{bubbles:!0,detail:e({autocomplete:this.api},i),cancelable:s,originalEvent:n});return n&&(o.originalEvent=n),this.input.dispatchEvent(o)}}],o&&s(n.prototype,o),r&&s(n,r),t}();return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new o(t,e);return i.api}}();
//# sourceMappingURL=a11y.autocomplete.min.js.map
