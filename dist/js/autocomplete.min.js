(()=>{var t=Object.defineProperty;var e=(e,n)=>t(e,"name",{value:n,configurable:true});var n=Drupal.t("Use current Location",{},{context:"Helsinki near you"});var s="https://api.hel.fi/servicemap/v2/address/";var i="location-loading";var{currentLanguage:o}=drupalSettings.path;var a=`\n  <div>\n    <span class="hel-icon hel-icon--locate" role="img" aria-hidden="true"></span>\n    ${n}\n  </div>\n`;var r=new AbortController;var l=e(t=>{if(t[o]){return t[o]}if(t.fi){return t.fi}return Object.values(t)[0]},"getTranslation");((Drupal,t)=>{const o=e(t=>{if(!A11yAutocomplete){throw new Error("A11yAutocomplete object not found. Make sure the library is loaded.")}if(!drupalSettings.helsinki_near_you_form){throw new Error("Helsinki near you form object not found. Configuration cannot be loaded for autocomplete.")}let o="geolocation"in navigator?[{label:a,value:n,index:0,item:{label:n,value:n}}]:[];const u=t.closest(".hds-text-input");const c=e(()=>{u.classList.add("hds-text-input--invalid");const t=document.createElement("span");t.classList.add("hds-text-input__error-text");t.textContent=Drupal.t("We couldn't retrieve your current location. Try entering an address.",{},{context:"Helsinki near you"});u.appendChild(t);o=[]},"displayLocationError");const d=e(()=>{u.classList.remove("hds-text-input--invalid");u.querySelector(".hds-text-input__error-text")?.remove()},"removeLocationError");const{autocompleteRoute:v,noResultsAssistiveHint:h,someResultsAssistiveHint:p,oneResultAssistiveHint:g,highlightedAssistiveHint:f,inputAssistiveHint:m,minCharAssistiveHint:y}=drupalSettings.helsinki_near_you_form;const A=A11yAutocomplete(t,{classes:{inputLoading:"loading",wrapper:"helfi-etusivu-autocomplete"},highlightedAssistiveHint:f,inputAssistiveHint:m,minCharAssistiveHint:y,minChars:0,noResultsAssistiveHint:h,oneResultAssistiveHint:g,someResultsAssistiveHint:p,source:e(async(t,e)=>{if(t.length<3){return e(o)}try{r.abort();r=new AbortController;const n=await fetch(`${v}?q=${t}`,{signal:r.signal});const s=await n.json();e(o.concat(s))}catch(t){if(t.name==="AbortError"){return}console.error(t);e(o)}},"source")});const L=A._internal_object;const _=e(e=>{L.close();if(e){t.classList.toggle(i,true);return}t.classList.toggle(i,false)},"setLoading");t.addEventListener("autocomplete-select",e=>{if(e.detail.selected.value!==n){return}e.preventDefault();_(t,L,true);navigator.geolocation.getCurrentPosition(async t=>{const{coords:{latitude:n,longitude:i}}=t;const o=new URLSearchParams({lat:n,lon:i});const a=new URL(s);a.search=o.toString();try{const t=await fetch(a.toString());const n=await t.json();e.target.value=l(n.results[0].full_name)}catch(t){c()}finally{_(false)}},()=>{c();_(false)})});t.addEventListener("focus",()=>{if(t.classList.contains(i)){return}if(L.input.value===""&&o.length){L.displayResults(o)}});t.addEventListener("keydown",t=>{if(L.input.value===""&&o.length&&L.suggestions.length===0&&t.key==="ArrowDown"){L.displayResults(o)}});t.addEventListener("change",d)},"init");Drupal.behaviors.helfi_etusivu_autocomplete={attach(e){t("a11y_autocomplete_element","[data-helfi-etusivu-autocomplete]",e).forEach(o)}}})(Drupal,once)})();